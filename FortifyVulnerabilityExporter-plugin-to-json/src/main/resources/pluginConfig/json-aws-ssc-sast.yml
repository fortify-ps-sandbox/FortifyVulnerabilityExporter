---
spring.config.activate.on-loader-plugin: ssc

json.awshub.sast.filter.expr: vuln.engineType=='SCA'
json.awshub.sast.format:
  fields:
    issues: $[vulnerabilityMappers.vulnerability.get()]
  vulnerabilityMappers.vulnerability.fields:
    SchemaVersion: 2018-10-08
    Id: $[vuln.projectVersionId]-$[vuln.id]
    ProductArn: '--'
    GeneratorId: '--'
    ProductName: 'Fortify SAST'
    CompanyName: OpenText
    Types: "[ 'Software and Configuration Checks/Vulnerabilities/CVE' ]"
    CreatedAt: $[#formatDateTime("yyyy-MM-dd'T'HH:mm:ss", applicationVersion.currentStaticScan?.uploadDate?:'1970-01-01T00:00:00')]
    UpdatedAt: $[#formatDateTime("yyyy-MM-dd'T'HH:mm:ss", applicationVersion.currentStaticScan?.uploadDate?:'1970-01-01T00:00:00')]
    Severity:
        Original: $[vuln.friority]
        Normalized: $[{Critical:10.0,High:8.9,Medium:6.9,Low:3.9}.get(vuln.friority)+'']
    Title: $[vuln.issueName]
    Description: $[#abbreviate(#htmlToText(vuln.details?.brief).replaceAll("&nbsp;", " "),510)]
    Remediation:
        Recommendation:
            Text: $[#abbreviate(#htmlToText(vuln.details?.recommendation).replaceAll("&nbsp;", " "),510)]
            Url: $[vuln.deepLink]
    ProductFields:
        Product Name: 'Fortify SAST'
    Resources:
        Type: Application
        Id: $[vuln.projectVersionId]-$[vuln.id]
        Partition: aws
        Region: '--'
        details:
            Other:
                APPLICATION: '$[vuln.projectVersionId]'
                APPLICATION NAME: $[vuln.applicationVersion.project.name]
                APPLICATION VERSION: $[vuln.applicationVersion.name]
                PRIMARY LOCATION: $[vuln.fullFileName]
                LINE NUMBER: '$[vuln.lineNumber==0?1:vuln.lineNumber]'
                INSTANCE ID: "$[vuln.instanceId]"
    RecordState: ACTIVE
  vulnerabilityMappers.vulnerability.value: $[vuln]